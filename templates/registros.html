<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <title>Trabajos Archivados</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
{% extends "base.html" %}
{% block title %}Trabajos Archivados{% endblock %}
{% block content %}
<div class="d-flex justify-content-end mb-3">
    <form action="{{ url_for('auth.logout') }}" method="get">
        <button type="submit" class="btn btn-outline-danger">Cerrar sesi√≥n</button>
    </form>
</div>
<div class="card p-4">
    <h1 class="mb-4 fs-2">Trabajos Archivados</h1>
    <form method="get" class="row g-3 mb-4 align-items-end">
        <div class="col-lg-3 col-md-6">
            <label class="form-label fw-bold w-100">Buscar por nombre</label>
            <input type="text" name="buscar" class="form-control w-100" placeholder="Buscar por nombre" value="{{ buscar_actual }}">
        </div>
        <div class="col-lg-2 col-md-6">
            <label class="form-label fw-bold w-100">Estado</label>
            <select name="estado" class="form-select w-100">
                <option value="">Todos los estados</option>
                {% for est in estados %}
                    <option value="{{ est }}" {% if est == estado_actual %}selected{% endif %}>{{ est }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="col-lg-2 col-md-6">
            <label class="form-label fw-bold w-100">Servicio</label>
            <select name="servicio" class="form-select w-100">
                <option value="">Todos los servicios</option>
                {% for serv in servicios %}
                    <option value="{{ serv }}" {% if serv == servicio_actual %}selected{% endif %}>{{ serv }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="col-lg-2 col-md-6">
            <label class="form-label fw-bold w-100">Desde</label>
            <input type="date" name="fecha_inicio" class="form-control w-100" value="{{ fecha_inicio }}">
        </div>
        <div class="col-lg-2 col-md-6">
            <label class="form-label fw-bold w-100">Hasta</label>
            <input type="date" name="fecha_fin" class="form-control w-100" value="{{ fecha_fin }}">
        </div>
        <div class="col-lg-1 col-md-6 d-grid">
            <button type="submit" class="btn btn-primary w-100">Filtrar</button>
        </div>
    </form>
    <div class="table-responsive">
        <table class="table table-striped table-hover align-middle fs-5" style="min-width:1200px;">
            <thead class="table-dark">
                <tr>
                    <th>ID</th>
                    <th>Nombre</th>
                    <th>Tipo de Servicio</th>
                    <th>Servicio</th>
                    <th>Cantidad</th>
                    <th>Estado</th>
                    <th>Observaciones</th>
                    <th>Fecha de Solicitud</th>
                    <th>Fecha de Entrega</th>
                </tr>
            </thead>
            <tbody>
                {% for registro in registros %}
                <tr>
                    <td>{{ registro[0] }}</td>
                    <td>{{ registro[1] }}</td>
                    <td>{{ registro[2] }}</td>
                    <td>{{ registro[3] }}</td>
                    <td>{{ registro[4] }}</td>
                    <td>{{ registro[5] }}</td>
                    <td style="text-align:center;">
                        <button type="button" class="btn btn-sm btn-info" onclick="mostrarObservacion('{{ registro[6]|escape }}')">Ver</button>
                    </td>
                    <td>{{ registro[7] or '' }}</td>
                    <td>{{ registro[8] or '' }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    <div class="mt-4 d-flex gap-3">
        <a href="{{ url_for('clientes.index') }}" class="btn btn-secondary btn-lg">Volver al formulario</a>
        <a href="{{ url_for('clientes.mostrar_usuarios') }}" class="btn btn-info btn-lg">Ver trabajos en progreso</a>
    </div>
</div>
<!-- Modal para mostrar observaciones -->
<div id="modalObservacion" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.5); align-items:center; justify-content:center; z-index:9999;">
    <div style="background:white; padding:30px; border-radius:12px; max-width:500px; margin:auto;">
        <h3>Observaciones</h3>
        <div id="textoObservacion" style="white-space:pre-wrap; font-size:1.2rem;"></div>
        <br>
        <button class="btn btn-secondary" onclick="cerrarModal()">Cerrar</button>
    </div>
</div>
<script>
function mostrarObservacion(texto) {
    document.getElementById('textoObservacion').innerText = texto || 'Sin observaciones';
    document.getElementById('modalObservacion').style.display = 'flex';
}
function cerrarModal() {
    document.getElementById('modalObservacion').style.display = 'none';
}
</script>
{% endblock %}
</body>
</html>
